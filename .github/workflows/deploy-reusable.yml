name: Deploy Reusable

on:
  workflow_call:
    inputs:
      instance_name:
        required: true
        type: string
      product_type:
        required: true
        type: string
      product_versions:
        required: true
        type: string

jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      INSTANCE:       ${{ inputs.instance_name }}
      PRODUCT_TYPE:   ${{ inputs.product_type }}
      VERSIONS_INPUT: ${{ inputs.product_versions }}

    steps:
      - name: Checkout repository (required for local actions)
        uses: actions/checkout@v4

      - name: Common pre-steps
        run: |
          echo "Common setup for instance: $INSTANCE"

      - name: Deploy Product1 (resolve + echo + deploy)
        if: ${{ env.PRODUCT_TYPE == 'All' || env.PRODUCT_TYPE == 'Product1' }}
        uses: ./.github/actions/ProductDeployment
        with:
          product:         'Product1'
          product_versions: ${{ env.VERSIONS_INPUT }}

      - name: Deploy Product2 (resolve + echo + deploy)
        if: ${{ env.PRODUCT_TYPE == 'All' || env.PRODUCT_TYPE == 'Product2' }}
        uses: ./.github/actions/ProductDeployment
        with:
          product:         'Product2'
          product_versions: ${{ env.VERSIONS_INPUT }}

      - name: Common post-steps
        run: |
          echo "Post-deploy tasks for instance: $INSTANCE"
